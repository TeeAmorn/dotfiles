#!/bin/bash
set -e 

# ========================================
# Miscellaneous
# ========================================

if ! [ -d "$HOME/Pictures/wallpaper" ]; then
    mkdir $HOME/Pictures/wallpaper
fi

if ! [ -f "$HOME/Pictures/wallpaper/nature.jpg" ]; then
    curl -L --create-dirs https://images.hdqwalls.com/download/tranquility-minimal-4k-6q-2560x1440.jpg > $HOME/Pictures/wallpaper/nature.jpg
fi

# ========================================
# Tools and Applications Installation
# ========================================

# Install Neofetch
if ! [ -x "$(command -v neofetch)" ]; then
    sudo dnf install -y neofetch
fi

# ========================================
# Nvim and Languages Installation
# ========================================

# Install Rust
if ! [ -x "$(command -v cargo)" ]; then
    curl https://sh.rustup.rs -sSf | sh
    source "$HOME/.cargo/env"
fi

# Install ripgrep; needed for Telescope in Nvim
if ! [ -x "$(command -v rg)" ]; then
    sudo dnf install -y ripgrep
fi

# Install Node.js; needed for certain LSPs used in Nvim
if ! [ -x "$(command -v npm)" ]; then
    sudo dnf module install -y nodejs:18/common
fi

# Install Nvim
if ! [ -x "$(command -v nvim)" ]; then
    sudo dnf install -y neovim python3-neovim
fi

# Copy Nvim configuration to .config/
if ! [ -d "./nvim" ]; then 
    cp -r ../nvim $HOME/.config
fi

# Install Packer.nvim
if ! [ -d "$HOME/.local/share/nvim/site/pack/packer/start/packer.nvim" ]; then
    git clone --depth 1 https://github.com/wbthomason/packer.nvim\
     $HOME/.local/share/nvim/site/pack/packer/start/packer.nvim
    # # Run PackerSync in Nvim and suppress all messages
    # nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync' &>/dev/null
fi

# ========================================
# i3 Installation
# ========================================

# Install i3
if ! [ -x "$(command -v i3)" ]; then
    sudo dnf install -y i3
fi
#
# Create i3 config
if ! [ -d "$HOME/.config/i3" ]; then
    cp -r ../i3 $HOME/.config
fi

# Create fonts config
if ! [ -d "$HOME/.local/share/fonts" ]; then
    cp -r ../fonts $HOME/.local/share
fi

# Install Rofi
if ! [ -x "$(command -v rofi)" ]; then
    sudo dnf install -y rofi
fi

# Create Rofi config
if ! [ -d "$HOME/.config/rofi" ]; then
    cp -r ../rofi $HOME/.config
fi

# Install Picom
if ! [ -x "$(command -v picom)" ]; then
    sudo dnf install -y picom
fi

# Create Picom config
if ! [ -d "$HOME/.config/picom" ]; then
    cp -r ../picom $HOME/.config
fi

# Install PolyBar
if ! [ -x "$(command -v polybar)" ]; then
    sudo dnf install -y polybar
fi

# Install pip3; needed for pywal
if ! [ -x "$(command -v pip3)" ]; then
    sudo dnf install -y python3-pip
fi

# Install pywal; needed for PolyBar themes
if ! [ -x "$(command -v wal)" ]; then
    git clone https://github.com/dylanaraps/pywal
    cd pywal
    pip3 install --user .
    cd ..
    rm -rf pywal
fi

# Install calc; needed for PolyBar themes
if ! [ -x "$(command -v calc)" ]; then
    sudo dnf install -y calc
fi

# Install networkmanager_dmenu; needed for PolyBar themes
if ! [ -x "$(command -v networkmanager_dmenu)" ]; then
    git clone https://github.com/firecat53/networkmanager-dmenu.git
    cd networkmanager-dmenu
    cp networkmanager_dmenu $HOME/.local/bin
    cd ..
    rm -rf networkmanager-dmenu
fi

# Create PolyBar config
if ! [ -d "$HOME/.config/rofi" ]; then
    cp -r ../polybar $HOME/.config
fi

# # ========================================
# # Alacritty Installation
# # ========================================
# 
# if ! [ -x "$(command -v alacritty)" ]; then
#     git clone https://github.com/alacritty/alacritty.git
#     cd alacritty
#     sudo dnf install -y cmake freetype-devel fontconfig-devel libxcb-devel libxkbcommon-devel g++
#     cargo build --release
#     sudo cp target/release/alacritty /usr/local/bin # or anywhere else in $PATH
#     sudo cp extra/logo/alacritty-term.svg /usr/share/pixmaps/Alacritty.svg
#     sudo desktop-file-install extra/linux/Alacritty.desktop
#     sudo update-desktop-database
#     mkdir -p ~/.bash_completion
#     cp extra/completions/alacritty.bash ~/.bash_completion/alacritty
#     echo "source ~/.bash_completion/alacritty" >> ~/.bashrc
#     cd ..
#     rm -rf alacritty
# fi
